dataset_name: orders_admin

mode: auto

input:
  format: excel
  file_pattern:
    - "*.xlsx"
    - "*.xlsb"
  header: true

output:
  format: parquet
  overwrite: true

options:
  strict_schema: false

transform:

  select:
    - Order_ID
    - Status
    - Service_Type
    - Service_Name
    - Vehicle
    - Driver_Vehicle_Plate
    - CASE 
        WHEN Sap_Profile_Id IS NULL OR Sap_Profile_Id = '' 
        THEN NULL 
        ELSE CAST(Sap_Profile_Id AS BIGINT)
      END AS Sap_Profile_Id
    - Payment_Method
    - CASE 
        WHEN Total_Fee_Display IS NULL OR Total_Fee_Display = '' 
        THEN NULL 
        ELSE CAST(Total_Fee_Display AS BIGINT)
      END AS Total_Fee_Display
    - Cancel_Reason
    - Detail_Reason
    - Cancel_By

  rename:
    Sap_Profile_Id: SAP_ID

  filters:
    - "\"Sap_Contract_Type\" = 'car'"

  computed:
  - name: Create_Time
    expr: "CASE WHEN \"Create_Time\" IS NULL OR \"Create_Time\" = '' 
            THEN NULL 
            ELSE CAST(\"Create_Time\" AS TIMESTAMP) 
           END"

  - name: Completed_Time
    expr: "CASE WHEN \"Completed_Time\" IS NULL OR \"Completed_Time\" = '' 
            THEN NULL 
            ELSE CAST(\"Completed_Time\" AS TIMESTAMP) 
           END"

  distinct: true
